

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. Sandbox &mdash; Jinja2 API</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Jinja2 API" href="index.html"/>
        <link rel="up" title="Stuffs from the official doc" href="off_doc.html"/>
        <link rel="next" title="4. Template Designer Documentation" href="off_doc.templates.html"/>
        <link rel="prev" title="2. API" href="off_doc.api.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Jinja2 API
          

          
          </a>

          
            
            
              <div class="version">
                1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="off_doc.html">Stuffs from the official doc</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="off_doc.intro.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="off_doc.api.html">2. API</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">3. Sandbox</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#api">3.1. API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sandboxedenvironment">3.1.1. <code class="docutils literal"><span class="pre">SandboxedEnvironment</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#immutablesandboxedenvironment">3.1.2. <code class="docutils literal"><span class="pre">ImmutableSandboxedEnvironment</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#securityerror">3.1.3. <code class="docutils literal"><span class="pre">SecurityError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#unsafe">3.1.4. <code class="docutils literal"><span class="pre">unsafe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-internal-attribute">3.1.5. <code class="docutils literal"><span class="pre">is_internal_attribute()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#modifies-known-mutable">3.1.6. <code class="docutils literal"><span class="pre">modifies_known_mutable()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#operator-intercepting">3.2. Operator Intercepting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="off_doc.templates.html">4. Template Designer Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="off_doc.extensions.html">5. Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="off_doc.extensions.writing.html">6. Writing Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="off_doc.integration.html">7. Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="off_doc.switching.html">8. Switching from other Template Engines</a></li>
<li class="toctree-l2"><a class="reference internal" href="off_doc.tricks.html">9. Tips and Tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="off_doc.faq.html">10. Frequently Asked Questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="generated/jinja2.html">jinja2</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/jinja2.sandbox.html">jinja2.sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/jinja2.exceptions.html">jinja2.exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/jinja2.environment.html">jinja2.environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/jinja2.runtime.html">jinja2.runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/jinja2.bccache.html">jinja2.bccache</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/jinja2.nodes.html">jinja2.nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/jinja2.ext.html">jinja2.ext</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/jinja2.lexer.html">jinja2.lexer</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/jinja2.parser.html">jinja2.parser</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Jinja2 API</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="off_doc.html">Stuffs from the official doc</a> &raquo;</li>
        
      <li>3. Sandbox</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/off_doc.sandbox.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-jinja2.sandbox">
<span id="sandbox"></span><h1>3. Sandbox<a class="headerlink" href="#module-jinja2.sandbox" title="Permalink to this headline">¶</a></h1>
<p>The Jinja2 sandbox can be used to evaluate untrusted code.  Access to unsafe
attributes and methods is prohibited.</p>
<p>Assuming <cite>env</cite> is a <a class="reference internal" href="generated/generated/jinja2.sandbox.SandboxedEnvironment.html#jinja2.sandbox.SandboxedEnvironment" title="jinja2.sandbox.SandboxedEnvironment"><code class="xref py py-class docutils literal"><span class="pre">SandboxedEnvironment</span></code></a> in the default configuration
the following piece of code shows how it works:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;{{ func.func_code }}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span><span class="bp">None</span><span class="p">)</span>
<span class="go">u&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;{{ func.func_code.do_something }}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span><span class="bp">None</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">SecurityError</span>: <span class="n">access to attribute &#39;func_code&#39; of &#39;function&#39; object is unsafe.</span>
</pre></div>
</div>
<div class="section" id="api">
<h2>3.1. API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sandboxedenvironment">
<h3>3.1.1. <a class="reference internal" href="generated/generated/jinja2.sandbox.SandboxedEnvironment.html#jinja2.sandbox.SandboxedEnvironment" title="jinja2.sandbox.SandboxedEnvironment"><code class="xref py py-class docutils literal"><span class="pre">SandboxedEnvironment</span></code></a><a class="headerlink" href="#sandboxedenvironment" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="immutablesandboxedenvironment">
<h3>3.1.2. <a class="reference internal" href="generated/generated/jinja2.sandbox.ImmutableSandboxedEnvironment.html#jinja2.sandbox.ImmutableSandboxedEnvironment" title="jinja2.sandbox.ImmutableSandboxedEnvironment"><code class="xref py py-class docutils literal"><span class="pre">ImmutableSandboxedEnvironment</span></code></a><a class="headerlink" href="#immutablesandboxedenvironment" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="securityerror">
<h3>3.1.3. <a class="reference internal" href="generated/jinja2.sandbox.SecurityError.html#jinja2.sandbox.SecurityError" title="jinja2.sandbox.SecurityError"><code class="xref py py-class docutils literal"><span class="pre">SecurityError</span></code></a><a class="headerlink" href="#securityerror" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="unsafe">
<h3>3.1.4. <a class="reference internal" href="generated/jinja2.sandbox.unsafe.html#jinja2.sandbox.unsafe" title="jinja2.sandbox.unsafe"><code class="xref py py-func docutils literal"><span class="pre">unsafe()</span></code></a><a class="headerlink" href="#unsafe" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="is-internal-attribute">
<h3>3.1.5. <a class="reference internal" href="generated/jinja2.sandbox.is_internal_attribute.html#jinja2.sandbox.is_internal_attribute" title="jinja2.sandbox.is_internal_attribute"><code class="xref py py-func docutils literal"><span class="pre">is_internal_attribute()</span></code></a><a class="headerlink" href="#is-internal-attribute" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="modifies-known-mutable">
<h3>3.1.6. <a class="reference internal" href="generated/jinja2.sandbox.modifies_known_mutable.html#jinja2.sandbox.modifies_known_mutable" title="jinja2.sandbox.modifies_known_mutable"><code class="xref py py-func docutils literal"><span class="pre">modifies_known_mutable()</span></code></a><a class="headerlink" href="#modifies-known-mutable" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The Jinja2 sandbox alone is no solution for perfect security.  Especially
for web applications you have to keep in mind that users may create
templates with arbitrary HTML in so it&#8217;s crucial to ensure that (if you
are running multiple users on the same server) they can&#8217;t harm each other
via JavaScript insertions and much more.</p>
<p>Also the sandbox is only as good as the configuration.  We strongly
recommend only passing non-shared resources to the template and use
some sort of whitelisting for attributes.</p>
<p class="last">Also keep in mind that templates may raise runtime or compile time errors,
so make sure to catch them.</p>
</div>
</div>
</div>
<div class="section" id="operator-intercepting">
<h2>3.2. Operator Intercepting<a class="headerlink" href="#operator-intercepting" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.6.</span></p>
</div>
<p>For maximum performance Jinja2 will let operators call directly the type
specific callback methods.  This means that it&#8217;s not possible to have this
intercepted by overriding <code class="xref py py-meth docutils literal"><span class="pre">Environment.call()</span></code>.  Furthermore a
conversion from operator to special method is not always directly possible
due to how operators work.  For instance for divisions more than one
special method exist.</p>
<p>With Jinja 2.6 there is now support for explicit operator intercepting.
This can be used to customize specific operators as necessary.  In order
to intercept an operator one has to override the
<a class="reference internal" href="generated/generated/jinja2.sandbox.SandboxedEnvironment.intercepted_binops.html#jinja2.sandbox.SandboxedEnvironment.intercepted_binops" title="jinja2.sandbox.SandboxedEnvironment.intercepted_binops"><code class="xref py py-attr docutils literal"><span class="pre">SandboxedEnvironment.intercepted_binops</span></code></a> attribute.  Once the
operator that needs to be intercepted is added to that set Jinja2 will
generate bytecode that calls the <a class="reference internal" href="generated/generated/jinja2.sandbox.SandboxedEnvironment.call_binop.html#jinja2.sandbox.SandboxedEnvironment.call_binop" title="jinja2.sandbox.SandboxedEnvironment.call_binop"><code class="xref py py-meth docutils literal"><span class="pre">SandboxedEnvironment.call_binop()</span></code></a>
function.  For unary operators the <cite>unary</cite> attributes and methods have to
be used instead.</p>
<p>The default implementation of <a class="reference internal" href="generated/generated/jinja2.sandbox.SandboxedEnvironment.call_binop.html#jinja2.sandbox.SandboxedEnvironment.call_binop" title="jinja2.sandbox.SandboxedEnvironment.call_binop"><code class="xref py py-attr docutils literal"><span class="pre">SandboxedEnvironment.call_binop</span></code></a>
will use the <code class="xref py py-attr docutils literal"><span class="pre">SandboxedEnvironment.binop_table</span></code> to translate
operator symbols into callbacks performing the default operator behavior.</p>
<p>This example shows how the power (<code class="docutils literal"><span class="pre">**</span></code>) operator can be disabled in
Jinja2:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jinja2.sandbox</span> <span class="kn">import</span> <span class="n">SandboxedEnvironment</span>


<span class="k">class</span> <span class="nc">MyEnvironment</span><span class="p">(</span><span class="n">SandboxedEnvironment</span><span class="p">):</span>
    <span class="n">intercepted_binops</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span><span class="s1">&#39;**&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">call_binop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;**&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">undefined</span><span class="p">(</span><span class="s1">&#39;the power operator is unavailable&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">SandboxedEnvironment</span><span class="o">.</span><span class="n">call_binop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span>
                                               <span class="n">operator</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
</pre></div>
</div>
<p>Make sure to always call into the super method, even if you are not
intercepting the call.  Jinja2 might internally call the method to
evaluate expressions.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="off_doc.templates.html" class="btn btn-neutral float-right" title="4. Template Designer Documentation" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="off_doc.api.html" class="btn btn-neutral" title="2. API" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/copybutton.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>