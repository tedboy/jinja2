

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>jinja2.sandbox &mdash; Jinja2 API</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Jinja2 API" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Jinja2 API
          

          
          </a>

          
            
            
              <div class="version">
                1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../generated/jinja2.html">1. jinja2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/jinja2.sandbox.html">2. jinja2.sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/jinja2.exceptions.html">3. jinja2.exceptions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Jinja2 API</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>jinja2.sandbox</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for jinja2.sandbox</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    jinja2.sandbox</span>
<span class="sd">    ~~~~~~~~~~~~~~</span>

<span class="sd">    Adds a sandbox layer to Jinja as it was the default behavior in the old</span>
<span class="sd">    Jinja 1 releases.  This sandbox is slightly different from Jinja 1 as the</span>
<span class="sd">    default behavior is easier to use.</span>

<span class="sd">    The behavior can be changed by subclassing the environment.</span>

<span class="sd">    :copyright: (c) 2010 by the Jinja Team.</span>
<span class="sd">    :license: BSD.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">from</span> <span class="nn">jinja2.environment</span> <span class="kn">import</span> <span class="n">Environment</span>
<span class="kn">from</span> <span class="nn">jinja2.exceptions</span> <span class="kn">import</span> <span class="n">SecurityError</span>
<span class="kn">from</span> <span class="nn">jinja2._compat</span> <span class="kn">import</span> <span class="n">string_types</span><span class="p">,</span> <span class="n">PY2</span>


<span class="c1">#: maximum number of items a range may produce</span>
<span class="n">MAX_RANGE</span> <span class="o">=</span> <span class="mi">100000</span>

<span class="c1">#: attributes of function objects that are considered unsafe.</span>
<span class="k">if</span> <span class="n">PY2</span><span class="p">:</span>
    <span class="n">UNSAFE_FUNCTION_ATTRIBUTES</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;func_closure&#39;</span><span class="p">,</span> <span class="s1">&#39;func_code&#39;</span><span class="p">,</span> <span class="s1">&#39;func_dict&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;func_defaults&#39;</span><span class="p">,</span> <span class="s1">&#39;func_globals&#39;</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># On versions &gt; python 2 the special attributes on functions are gone,</span>
    <span class="c1"># but they remain on methods and generators for whatever reason.</span>
    <span class="n">UNSAFE_FUNCTION_ATTRIBUTES</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>


<span class="c1">#: unsafe method attributes.  function attributes are unsafe for methods too</span>
<span class="n">UNSAFE_METHOD_ATTRIBUTES</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;im_class&#39;</span><span class="p">,</span> <span class="s1">&#39;im_func&#39;</span><span class="p">,</span> <span class="s1">&#39;im_self&#39;</span><span class="p">])</span>

<span class="c1">#: unsafe generator attirbutes.</span>
<span class="n">UNSAFE_GENERATOR_ATTRIBUTES</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;gi_frame&#39;</span><span class="p">,</span> <span class="s1">&#39;gi_code&#39;</span><span class="p">])</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># make sure we don&#39;t warn in python 2.6 about stuff we don&#39;t care about</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="s1">&#39;the sets module&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span>
                        <span class="n">module</span><span class="o">=</span><span class="s1">&#39;jinja2.sandbox&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="n">_mutable_set_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">set</span><span class="p">,)</span>
<span class="n">_mutable_mapping_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,)</span>
<span class="n">_mutable_sequence_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">,)</span>


<span class="c1"># on python 2.x we can register the user collection types</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">UserDict</span> <span class="kn">import</span> <span class="n">UserDict</span><span class="p">,</span> <span class="n">DictMixin</span>
    <span class="kn">from</span> <span class="nn">UserList</span> <span class="kn">import</span> <span class="n">UserList</span>
    <span class="n">_mutable_mapping_types</span> <span class="o">+=</span> <span class="p">(</span><span class="n">UserDict</span><span class="p">,</span> <span class="n">DictMixin</span><span class="p">)</span>
    <span class="n">_mutable_set_types</span> <span class="o">+=</span> <span class="p">(</span><span class="n">UserList</span><span class="p">,)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="c1"># if sets is still available, register the mutable set from there as well</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sets</span> <span class="kn">import</span> <span class="n">Set</span>
    <span class="n">_mutable_set_types</span> <span class="o">+=</span> <span class="p">(</span><span class="n">Set</span><span class="p">,)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="c1">#: register Python 2.6 abstract base classes</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">MutableSet</span><span class="p">,</span> <span class="n">MutableMapping</span><span class="p">,</span> <span class="n">MutableSequence</span>
    <span class="n">_mutable_set_types</span> <span class="o">+=</span> <span class="p">(</span><span class="n">MutableSet</span><span class="p">,)</span>
    <span class="n">_mutable_mapping_types</span> <span class="o">+=</span> <span class="p">(</span><span class="n">MutableMapping</span><span class="p">,)</span>
    <span class="n">_mutable_sequence_types</span> <span class="o">+=</span> <span class="p">(</span><span class="n">MutableSequence</span><span class="p">,)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">_mutable_spec</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">_mutable_set_types</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">([</span>
        <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;clear&#39;</span><span class="p">,</span> <span class="s1">&#39;difference_update&#39;</span><span class="p">,</span> <span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="s1">&#39;pop&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">,</span>
        <span class="s1">&#39;symmetric_difference_update&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span>
    <span class="p">])),</span>
    <span class="p">(</span><span class="n">_mutable_mapping_types</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">([</span>
        <span class="s1">&#39;clear&#39;</span><span class="p">,</span> <span class="s1">&#39;pop&#39;</span><span class="p">,</span> <span class="s1">&#39;popitem&#39;</span><span class="p">,</span> <span class="s1">&#39;setdefault&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span>
    <span class="p">])),</span>
    <span class="p">(</span><span class="n">_mutable_sequence_types</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">([</span>
        <span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;insert&#39;</span><span class="p">,</span> <span class="s1">&#39;sort&#39;</span><span class="p">,</span> <span class="s1">&#39;extend&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span>
    <span class="p">])),</span>
    <span class="p">(</span><span class="n">deque</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">([</span>
        <span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="s1">&#39;appendleft&#39;</span><span class="p">,</span> <span class="s1">&#39;clear&#39;</span><span class="p">,</span> <span class="s1">&#39;extend&#39;</span><span class="p">,</span> <span class="s1">&#39;extendleft&#39;</span><span class="p">,</span> <span class="s1">&#39;pop&#39;</span><span class="p">,</span>
        <span class="s1">&#39;popleft&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="s1">&#39;rotate&#39;</span>
    <span class="p">]))</span>
<span class="p">)</span>


<div class="viewcode-block" id="safe_range"><a class="viewcode-back" href="../../generated/jinja2.sandbox.safe_range.html#jinja2.sandbox.safe_range">[docs]</a><span class="k">def</span> <span class="nf">safe_range</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A range that can&#39;t generate ranges with a length of more than</span>
<span class="sd">    MAX_RANGE items.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MAX_RANGE</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">OverflowError</span><span class="p">(</span><span class="s1">&#39;range too big, maximum size for range is </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
                            <span class="n">MAX_RANGE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rng</span></div>


<div class="viewcode-block" id="unsafe"><a class="viewcode-back" href="../../generated/jinja2.sandbox.unsafe.html#jinja2.sandbox.unsafe">[docs]</a><span class="k">def</span> <span class="nf">unsafe</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Marks a function or method as unsafe.</span>

<span class="sd">    ::</span>

<span class="sd">        @unsafe</span>
<span class="sd">        def delete(self):</span>
<span class="sd">            pass</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span><span class="o">.</span><span class="n">unsafe_callable</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">f</span></div>


<div class="viewcode-block" id="is_internal_attribute"><a class="viewcode-back" href="../../generated/jinja2.sandbox.is_internal_attribute.html#jinja2.sandbox.is_internal_attribute">[docs]</a><span class="k">def</span> <span class="nf">is_internal_attribute</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test if the attribute given is an internal python attribute.  For</span>
<span class="sd">    example this function returns `True` for the `func_code` attribute of</span>
<span class="sd">    python objects.  This is useful if the environment method</span>
<span class="sd">    :meth:`~SandboxedEnvironment.is_safe_attribute` is overridden.</span>

<span class="sd">    &gt;&gt;&gt; from jinja2.sandbox import is_internal_attribute</span>
<span class="sd">    &gt;&gt;&gt; is_internal_attribute(str, &quot;mro&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; is_internal_attribute(str, &quot;upper&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">UNSAFE_FUNCTION_ATTRIBUTES</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">UNSAFE_FUNCTION_ATTRIBUTES</span> <span class="ow">or</span> \
           <span class="n">attr</span> <span class="ow">in</span> <span class="n">UNSAFE_METHOD_ATTRIBUTES</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;mro&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">CodeType</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">TracebackType</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FrameType</span><span class="p">)):</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">GeneratorType</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">UNSAFE_GENERATOR_ATTRIBUTES</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="modifies_known_mutable"><a class="viewcode-back" href="../../generated/jinja2.sandbox.modifies_known_mutable.html#jinja2.sandbox.modifies_known_mutable">[docs]</a><span class="k">def</span> <span class="nf">modifies_known_mutable</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function checks if an attribute on a builtin mutable object</span>
<span class="sd">    (list, dict, set or deque) would modify it if called.  It also supports</span>
<span class="sd">    the &quot;user&quot;-versions of the objects (`sets.Set`, `UserDict.*` etc.) and</span>
<span class="sd">    with Python 2.6 onwards the abstract base classes `MutableSet`,</span>
<span class="sd">    `MutableMapping`, and `MutableSequence`.</span>

<span class="sd">    &gt;&gt;&gt; modifies_known_mutable({}, &quot;clear&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; modifies_known_mutable({}, &quot;keys&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; modifies_known_mutable([], &quot;append&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; modifies_known_mutable([], &quot;index&quot;)</span>
<span class="sd">    False</span>

<span class="sd">    If called with an unsupported object (such as unicode) `False` is</span>
<span class="sd">    returned.</span>

<span class="sd">    &gt;&gt;&gt; modifies_known_mutable(&quot;foo&quot;, &quot;upper&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">typespec</span><span class="p">,</span> <span class="n">unsafe</span> <span class="ow">in</span> <span class="n">_mutable_spec</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">typespec</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">unsafe</span>
    <span class="k">return</span> <span class="bp">False</span></div>


<div class="viewcode-block" id="SandboxedEnvironment"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.SandboxedEnvironment.html#jinja2.sandbox.SandboxedEnvironment">[docs]</a><span class="k">class</span> <span class="nc">SandboxedEnvironment</span><span class="p">(</span><span class="n">Environment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The sandboxed environment.  It works like the regular environment but</span>
<span class="sd">    tells the compiler to generate sandboxed code.  Additionally subclasses of</span>
<span class="sd">    this environment may override the methods that tell the runtime what</span>
<span class="sd">    attributes or functions are safe to access.</span>

<span class="sd">    If the template tries to access insecure code a :exc:`SecurityError` is</span>
<span class="sd">    raised.  However also other exceptions may occour during the rendering so</span>
<span class="sd">    the caller has to ensure that all exceptions are catched.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sandboxed</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c1">#: default callback table for the binary operators.  A copy of this is</span>
    <span class="c1">#: available on each instance of a sandboxed environment as</span>
    <span class="c1">#: :attr:`binop_table`</span>
    <span class="n">default_binop_table</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;+&#39;</span><span class="p">:</span>        <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
        <span class="s1">&#39;-&#39;</span><span class="p">:</span>        <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span>
        <span class="s1">&#39;*&#39;</span><span class="p">:</span>        <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span>
        <span class="s1">&#39;/&#39;</span><span class="p">:</span>        <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">,</span>
        <span class="s1">&#39;//&#39;</span><span class="p">:</span>       <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">,</span>
        <span class="s1">&#39;**&#39;</span><span class="p">:</span>       <span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">,</span>
        <span class="s1">&#39;%&#39;</span><span class="p">:</span>        <span class="n">operator</span><span class="o">.</span><span class="n">mod</span>
    <span class="p">}</span>

    <span class="c1">#: default callback table for the unary operators.  A copy of this is</span>
    <span class="c1">#: available on each instance of a sandboxed environment as</span>
    <span class="c1">#: :attr:`unop_table`</span>
    <span class="n">default_unop_table</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;+&#39;</span><span class="p">:</span>        <span class="n">operator</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span>
        <span class="s1">&#39;-&#39;</span><span class="p">:</span>        <span class="n">operator</span><span class="o">.</span><span class="n">neg</span>
    <span class="p">}</span>

    <span class="c1">#: a set of binary operators that should be intercepted.  Each operator</span>
    <span class="c1">#: that is added to this set (empty by default) is delegated to the</span>
    <span class="c1">#: :meth:`call_binop` method that will perform the operator.  The default</span>
    <span class="c1">#: operator callback is specified by :attr:`binop_table`.</span>
    <span class="c1">#:</span>
    <span class="c1">#: The following binary operators are interceptable:</span>
    <span class="c1">#: ``//``, ``%``, ``+``, ``*``, ``-``, ``/``, and ``**``</span>
    <span class="c1">#:</span>
    <span class="c1">#: The default operation form the operator table corresponds to the</span>
    <span class="c1">#: builtin function.  Intercepted calls are always slower than the native</span>
    <span class="c1">#: operator call, so make sure only to intercept the ones you are</span>
    <span class="c1">#: interested in.</span>
    <span class="c1">#:</span>
    <span class="c1">#: .. versionadded:: 2.6</span>
    <span class="n">intercepted_binops</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">()</span>

    <span class="c1">#: a set of unary operators that should be intercepted.  Each operator</span>
    <span class="c1">#: that is added to this set (empty by default) is delegated to the</span>
    <span class="c1">#: :meth:`call_unop` method that will perform the operator.  The default</span>
    <span class="c1">#: operator callback is specified by :attr:`unop_table`.</span>
    <span class="c1">#:</span>
    <span class="c1">#: The following unary operators are interceptable: ``+``, ``-``</span>
    <span class="c1">#:</span>
    <span class="c1">#: The default operation form the operator table corresponds to the</span>
    <span class="c1">#: builtin function.  Intercepted calls are always slower than the native</span>
    <span class="c1">#: operator call, so make sure only to intercept the ones you are</span>
    <span class="c1">#: interested in.</span>
    <span class="c1">#:</span>
    <span class="c1">#: .. versionadded:: 2.6</span>
    <span class="n">intercepted_unops</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">()</span>

<div class="viewcode-block" id="SandboxedEnvironment.intercept_unop"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.SandboxedEnvironment.intercept_unop.html#jinja2.sandbox.SandboxedEnvironment.intercept_unop">[docs]</a>    <span class="k">def</span> <span class="nf">intercept_unop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called during template compilation with the name of a unary</span>
<span class="sd">        operator to check if it should be intercepted at runtime.  If this</span>
<span class="sd">        method returns `True`, :meth:`call_unop` is excuted for this unary</span>
<span class="sd">        operator.  The default implementation of :meth:`call_unop` will use</span>
<span class="sd">        the :attr:`unop_table` dictionary to perform the operator with the</span>
<span class="sd">        same logic as the builtin one.</span>

<span class="sd">        The following unary operators are interceptable: ``+`` and ``-``</span>

<span class="sd">        Intercepted calls are always slower than the native operator call,</span>
<span class="sd">        so make sure only to intercept the ones you are interested in.</span>

<span class="sd">        .. versionadded:: 2.6</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">False</span></div>


<div class="viewcode-block" id="SandboxedEnvironment.__init__"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.SandboxedEnvironment.__init__.html#jinja2.sandbox.SandboxedEnvironment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Environment</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s1">&#39;range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">safe_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binop_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_binop_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unop_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_unop_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="SandboxedEnvironment.is_safe_attribute"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.SandboxedEnvironment.is_safe_attribute.html#jinja2.sandbox.SandboxedEnvironment.is_safe_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">is_safe_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The sandboxed environment will call this method to check if the</span>
<span class="sd">        attribute of an object is safe to access.  Per default all attributes</span>
<span class="sd">        starting with an underscore are considered private as well as the</span>
<span class="sd">        special attributes of internal python objects as returned by the</span>
<span class="sd">        :func:`is_internal_attribute` function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_internal_attribute</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span></div>

<div class="viewcode-block" id="SandboxedEnvironment.is_safe_callable"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.SandboxedEnvironment.is_safe_callable.html#jinja2.sandbox.SandboxedEnvironment.is_safe_callable">[docs]</a>    <span class="k">def</span> <span class="nf">is_safe_callable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if an object is safely callable.  Per default a function is</span>
<span class="sd">        considered safe unless the `unsafe_callable` attribute exists and is</span>
<span class="sd">        True.  Override this method to alter the behavior, but this won&#39;t</span>
<span class="sd">        affect the `unsafe` decorator from this module.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;unsafe_callable&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;alters_data&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span></div>

<div class="viewcode-block" id="SandboxedEnvironment.call_binop"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.SandboxedEnvironment.call_binop.html#jinja2.sandbox.SandboxedEnvironment.call_binop">[docs]</a>    <span class="k">def</span> <span class="nf">call_binop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For intercepted binary operator calls (:meth:`intercepted_binops`)</span>
<span class="sd">        this function is executed instead of the builtin operator.  This can</span>
<span class="sd">        be used to fine tune the behavior of certain operators.</span>

<span class="sd">        .. versionadded:: 2.6</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binop_table</span><span class="p">[</span><span class="n">operator</span><span class="p">](</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></div>

<div class="viewcode-block" id="SandboxedEnvironment.call_unop"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.SandboxedEnvironment.call_unop.html#jinja2.sandbox.SandboxedEnvironment.call_unop">[docs]</a>    <span class="k">def</span> <span class="nf">call_unop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For intercepted unary operator calls (:meth:`intercepted_unops`)</span>
<span class="sd">        this function is executed instead of the builtin operator.  This can</span>
<span class="sd">        be used to fine tune the behavior of certain operators.</span>

<span class="sd">        .. versionadded:: 2.6</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unop_table</span><span class="p">[</span><span class="n">operator</span><span class="p">](</span><span class="n">arg</span><span class="p">)</span></div>

<div class="viewcode-block" id="SandboxedEnvironment.getitem"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.SandboxedEnvironment.getitem.html#jinja2.sandbox.SandboxedEnvironment.getitem">[docs]</a>    <span class="k">def</span> <span class="nf">getitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subscribe an object from sandboxed code.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span><span class="p">[</span><span class="n">argument</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">LookupError</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">attr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_safe_attribute</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                            <span class="k">return</span> <span class="n">value</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsafe_undefined</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">undefined</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">argument</span><span class="p">)</span></div>

<div class="viewcode-block" id="SandboxedEnvironment.getattr"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.SandboxedEnvironment.getattr.html#jinja2.sandbox.SandboxedEnvironment.getattr">[docs]</a>    <span class="k">def</span> <span class="nf">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subscribe an object from sandboxed code and prefer the</span>
<span class="sd">        attribute.  The attribute passed *must* be a bytestring.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">obj</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">LookupError</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_safe_attribute</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsafe_undefined</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">undefined</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">attribute</span><span class="p">)</span></div>

<div class="viewcode-block" id="SandboxedEnvironment.unsafe_undefined"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.SandboxedEnvironment.unsafe_undefined.html#jinja2.sandbox.SandboxedEnvironment.unsafe_undefined">[docs]</a>    <span class="k">def</span> <span class="nf">unsafe_undefined</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an undefined object for unsafe attributes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">undefined</span><span class="p">(</span><span class="s1">&#39;access to attribute </span><span class="si">%r</span><span class="s1"> of </span><span class="si">%r</span><span class="s1"> &#39;</span>
                              <span class="s1">&#39;object is unsafe.&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">attribute</span><span class="p">,</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">attribute</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">SecurityError</span><span class="p">)</span></div>

<div class="viewcode-block" id="SandboxedEnvironment.call"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.SandboxedEnvironment.call.html#jinja2.sandbox.SandboxedEnvironment.call">[docs]</a>    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">__self</span><span class="p">,</span> <span class="n">__context</span><span class="p">,</span> <span class="n">__obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call an object from sandboxed code.&quot;&quot;&quot;</span>
        <span class="c1"># the double prefixes are to avoid double keyword argument</span>
        <span class="c1"># errors when proxying the call.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">__self</span><span class="o">.</span><span class="n">is_safe_callable</span><span class="p">(</span><span class="n">__obj</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SecurityError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> is not safely callable&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">__obj</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">__context</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">__obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ImmutableSandboxedEnvironment"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.ImmutableSandboxedEnvironment.html#jinja2.sandbox.ImmutableSandboxedEnvironment">[docs]</a><span class="k">class</span> <span class="nc">ImmutableSandboxedEnvironment</span><span class="p">(</span><span class="n">SandboxedEnvironment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Works exactly like the regular `SandboxedEnvironment` but does not</span>
<span class="sd">    permit modifications on the builtin mutable objects `list`, `set`, and</span>
<span class="sd">    `dict` by using the :func:`modifies_known_mutable` function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ImmutableSandboxedEnvironment.is_safe_attribute"><a class="viewcode-back" href="../../generated/generated/jinja2.sandbox.ImmutableSandboxedEnvironment.is_safe_attribute.html#jinja2.sandbox.ImmutableSandboxedEnvironment.is_safe_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">is_safe_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">SandboxedEnvironment</span><span class="o">.</span><span class="n">is_safe_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">modifies_known_mutable</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>